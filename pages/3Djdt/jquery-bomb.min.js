/*
 * author www.520it.com zhaoyanmingfei@qq.com
 * Version V1.0.2
 * Injection jquery
 */

;(function($){$.fn.bomb=function(options){var imgs=[];var hrefs=[];$(this).find('ul li').each(function(index,ele){var newele=$(ele).find('img');var href=$(ele).find('a');imgs.push(newele.attr('src'));hrefs.push(href.attr('href'))});$(this).find('ul').hide();if(imgs.length==0){console.log('对不起，文档当中无图，希望重新指定');return};var box=$('<style id="bomb-style"></style><div class="bomb-box"><a class="bomb-href" href="#"></a><button>&lt;</button><button>&gt;</button></div>');$(this).append(box);var defaults={col:6,row:4};var opts=$.extend({},defaults,options);var imgwidth=$(this).width();var imgheight=$(this).height();var gridrow=opts.row<2?2:opts.row;var gridcol=opts.col<2?2:opts.col;var str='';var num=0;var timer=null;var btn=false;var offset=[];var oaleft=$('.bomb-href').offset().left;var oatop=$('.bomb-href').offset().top;var ospanw=imgwidth/gridcol;var ospanh=imgheight/gridrow;$('#bomb-style').html($('#bomb-style').html()+'.bomb-box span{float:left;width:'+ospanw+'px;height:'+ospanh+'px}');for(var i=0;i<gridcol*gridrow;i+=1){str+='<span></span>'}$('.bomb-href').html(str);$('.bomb-href span').each(function(index,element){var left=$(element).offset().left-oaleft;var top=$(element).offset().top-oatop;offset.push({l:left,t:top})});go();$('.bomb-box').hover(function(e){clearInterval(timer)},function(){go()});$('.bomb-box button:eq(0)').click(function(e){bong('left')});$('.bomb-box button:eq(1)').click(function(e){bong('right')});function go(){clearInterval(timer);timer=setInterval(function(){bong('right')},3000)}$('.bomb-href').css({background:'url('+imgs[num]+') no-repeat'}).attr('href',hrefs[num]);function bong(dir){if(btn==false){btn=true}else{return};$('.bomb-href').html('');for(var i=0;i<gridcol*gridrow;i+=1){var str='<span></span>';$('.bomb-href').html($('.bomb-href').html()+str)};$('.bomb-href span').each(function(index,element){$(element).css({left:offset[index].l,top:offset[index].t,position:'absolute',background:'url('+imgs[num]+') no-repeat -'+offset[index].l+'px -'+offset[index].t+'px',transition:'all 0.5s ease-out'});var left=(offset[index].l+(ospanw/2)-(imgwidth/2))*rnd(2,3)+(imgwidth/2)-(ospanw/2);var top=(offset[index].t+(ospanh/2)-(imgheight/2))*rnd(2,3)+(imgheight/2)-(ospanh/2);setTimeout((function(ele,l,t){return function(){$(element).css({opacity:0,left:left,top:top,transform:'rotateX('+rnd(-180,180)+'deg) rotateY('+rnd(-180,180)+'deg) rotateZ('+rnd(-180,180)+'deg) scale('+rnd(1.5,3)+','+rnd(1.5,3)+')'})}})(element,left,top),rnd(0,200))});if(dir=='left'){num-=1}else{num+=1}num=(num+imgs.length)%imgs.length;$('.bomb-href').css({background:'url('+imgs[num]+') no-repeat'}).attr('href',hrefs[num]);setTimeout(function(){btn=false},700)}function rnd(min,max){return Math.random()*(max-min)+min}}})(window.jQuery);